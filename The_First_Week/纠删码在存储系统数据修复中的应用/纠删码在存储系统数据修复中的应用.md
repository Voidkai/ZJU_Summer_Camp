# 纠删码在存储系统数据修复中的应用

## 基本概念

1. 数据块： 原始用户数据被系统划分形成的最小编码单元
2. 校验块： 由数据块通过相关运算得到的检验数据
3. 条带： 多个数据块与其对应的校验块构成的冗余集合
4. 容错能力： 最大允许出错节点数
5. 最大距离可分码MDS：满足Singleton边界的线性编码方式。同等容错能力下拥有更低的存储开销。
6. 参与节点： 参与数据修复的节点
7. 修复节点：重建丢失数据的节点。
8. 存储利用率：原始数据与编码后所占存储空间的比值。

## 以RS码为例的编码修复过程

![](.\Pic\RS_Revovery.png)

1. 利用生成矩阵得到条带数据
2. 当数据块出现丢失时，首先从生成矩阵中去除相应行后的到残余矩阵，然后求解参与矩阵的逆矩阵
3. 逆矩阵右乘存活数据从而恢复丢失数据。

### 分布式存储系统的修复过程

1. 参与节点从本地此版读取所需数据
2. 为了减小数据传输量， 参与节点对数据在本地合并后生成传输数据。
3. 参与节点将传输数据通过网络传输到修复节点
4. 修复节点接受到所有数据后通过计算得出丢失数据。

### 两种操作触发数据修复

1. 降级读（Degrade read）：

   1. 用户访问丢失数据触发数据修复
   2. 导致用户请求延迟显著增加

2. 主动修复（proactive repair）：

   1. 系统监测到节点失效或是数据丢失从而主动进行数据修复。
   2. 占用系统的计算资源，磁盘资源以及网络带宽资源，从而对用户性能造成干扰

**加快修复速度，降低修复开销是修复分布式数据存储系统的主要问题。**